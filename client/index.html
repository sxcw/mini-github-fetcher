<html>
<head>
  <title>GitHub Fetcher</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

<link href='https://fonts.googleapis.com/css?family=Lato:300|Raleway:600' rel='stylesheet' type='text/css'>
<style media="screen" type="text/css">
	body, h1 span {
		font-family: 'Lato', sans-serif;
		color: #666;
	}

	h1,h2,h3, .highlight{
		font-family: 'Raleway', sans-serif;
	}
	h1 {
		color: #000;
		font-size: 40px;
		margin: 60px 0 0 0;
	}

	.circle {
		width: 10px;
		height: 10px;
		background: #ccc;
		border-radius: 5px;
		display: inline-block;
		margin-right: 7px;
		margin-bottom: 50px;
	}
	.circle:nth-of-type(1){
		margin-left: 145px;
	}

	form {
	  width: 100%;
	  color: #555;
	  border: 1px solid #ccc;
	  border-radius: 4px;
	  padding: 20px;
	}

	.btn-default:hover, a:hover {
		color: #DC2227;
		text-decoration: none;
	}
	.container {
		margin-top: 20px;
	}

</style>


</head>
<body>

<div class='container'>
	<div class='rows'> 
		<div class='col-md-6'>
			<h1>GitHub <span>Fetcher<span></h1>
			<div class="circle"></div> 
			<div class="circle"></div> 
			<div class="circle"></div>
			<div class="circle"></div> 
			<div class="circle"></div>
		</div>
		<div class='col-md-6'>
			<form class="repo-fetcher form-group content-main">
				
			  <h4>Enter a GitHub username to fetch</h4>
			  <input type="text" name="username" class="form-control md-col-6"/>

			  <br/>
			  <button type="submit" class='btn btn-default'>Fetch User's Repos</button>
			</form>

		</div>
	</div>

	
	<table id='entryTable' class="top-repos table table-striped">
		<thead>
			<tr>
				<th> Username </th>
				<th> Repo Name</th>
				<th> Stargazer Count</th>
			</tr>
		</thead>
		<tbody>

		</tbody>
	</table>
</div>

<script src="https://code.jquery.com/jquery-2.2.0.js"></script>
<script>

//
// TODO:
//  Respond to the form's `submit` event,
//  fetch from GitHub's API,
//  and send result to POST /repos/import
//
// $('.repo-fetcher')...

$( document ).ready(function() {
	var accessToken = '53613d38ece31b0802994eae2a2096690206a5c3';
    $('.repo-fetcher').submit(function(event){
    	event.preventDefault();
    	var $username = $('input').val();
    	requestJSON($username);

    })

    function requestJSON($username) {
       $.ajax({
       	 type:'GET',
         //url: "https://api.github.com/users/" + $username +'/repos',
         url: `https://api.github.com/users/${$username}/repos?access_token=53613d38ece31b0802994eae2a2096690206a5c3`,
         dataType : "jsonp",
         'content-type':'appliation/json',
         complete: function(resp) {
         	console.log('in requestJSON~~~~~~~~~~~~1', resp.responseJSON.data)
         	passDataToExpress(resp.responseJSON.data);
         }
       });
     }

     function passDataToExpress(userData){
     	console.log('in A~~~~~~~userData', userData)
     	userData = userData.map(function(item){
     		console.log(item.id);
     		return {

     			id: item.id,
     			name: item.name,
     			username: item.owner.login,
     			stargazers: item.stargazers_count
     		}
     	})
     	console.log('my userData~~~~~~~~2', userData);
     	$.ajax({
     	  type:'POST',
     	  url: '/repos/import',
     	  data: JSON.stringify(userData),
     	  dataType : "json",
     	  contentType:'application/json',
     	  success: function(resp) {
     	  	console.log('in passDataToExpress~~~~~~~~~~~~3', resp);
     	  },
     	  error: function(err) {
     	  	console.error('error in passDataToExpress~~~~~~~~~4', err);
     	  }
     	});
     }

     function getTop25(){
     	$.ajax({
 		  type:'GET',
       	  url: '/repos',
       	  //data: JSON.stringify(userData),
       	  //dataType : "json",
       	  //contentType:'application/json',
       	  complete: function(resp) {
       	  	console.log('in getTop25~~~~~~~~~~~~5', resp);
       	  	showTop25(resp.responseJSON);
       	  }
     })
 	}

 	function showTop25(arr){

 		arr.forEach(function(repo){
 			var $entry = $('<tr></tr>')
 			var $entryUsername = $('<td></td>').addClass('highlight').text(repo.username).appendTo($entry);
 			var $link = $(`<a href=http://www.github.com/${repo.username}/${repo.name} target= _blank /></a>`).append('<span class="play"></span>').text(repo.name);
 			var $entryRepoName = $('<td></td>').append($link)

 			$entryRepoName.appendTo($entry);
 			var $entryStargazers = $('<td></td>').text(repo.stargazers).appendTo($entry);

 			$entry.appendTo('tbody');
 		})
 	}
 	
     getTop25();

});



</script>
</body>
</html>