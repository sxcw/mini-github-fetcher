<html>
<head>
  <title>GitHub Fetcher</title>
</head>
<body>

<h2>GitHub Fetcher</h2>
<form class="repo-fetcher">
  <h3>Enter a GitHub username to fetch:</h3>
  <input type="text" name="username" />

  <button type="submit">Fetch User's Repos</button>
</form>

<table class="top-repos"></table>

<script src="https://code.jquery.com/jquery-2.2.0.js"></script>
<script>

//
// TODO:
//  Respond to the form's `submit` event,
//  fetch from GitHub's API,
//  and send result to POST /repos/import
//
// $('.repo-fetcher')...

$( document ).ready(function() {
	var accessToken = '53613d38ece31b0802994eae2a2096690206a5c3';
    $('.repo-fetcher').submit(function(event){
    	event.preventDefault();
    	var $username = $('input').val();
    	requestJSON($username);

    })

    function requestJSON($username) {
       $.ajax({
       	 type:'GET',
         //url: "https://api.github.com/users/" + $username +'/repos',
         url: `https://api.github.com/users/${$username}/repos?access_token=53613d38ece31b0802994eae2a2096690206a5c3`,
         dataType : "jsonp",
         'content-type':'appliation/json',
         complete: function(resp) {
         	console.log('in requestJSON~~~~~~~~~~~~1', resp.responseJSON.data)
         	passDataToExpress(resp.responseJSON.data);
         }
       });
     }

     function passDataToExpress(userData){
     	//console.log('in A~~~~~~~userData', userData)
     	userData = userData.map(function(item){
     		return {
     			name: item.name,
     			username: item.owner.login,
     			stargazers: item.stargazers_count
     		}
     	})
     	console.log('my userData~~~~~~~~2', userData);
     	$.ajax({
     	  type:'POST',
     	  url: '/repos/import',
     	  data: JSON.stringify(userData),
     	  dataType : "json",
     	  contentType:'application/json',
     	  success: function(resp) {
     	  	console.log('in passDataToExpress~~~~~~~~~~~~3', resp);
     	  },
     	  error: function(err) {
     	  	console.error('error in passDataToExpress~~~~~~~~~4', err);
     	  }
     	});
     }

});



</script>
</body>
</html>